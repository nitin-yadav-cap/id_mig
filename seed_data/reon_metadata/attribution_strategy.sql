-- MySQL dump 10.13  Distrib 8.0.25, for macos11 (x86_64)
--
-- Host: localhost    Database: nightly_mod
-- ------------------------------------------------------
-- Server version	8.0.25


--
-- Dumping data for table `attribution_strategy`
--

REPLACE INTO `attribution_strategy` (`strategy_id`, `strategy_name`, `strategy_json`, `is_active`, `updated_on`, `strategy_id_str`) VALUES (1,'column','{\n        \"joinKeys\": [{\"from\": \"nsadmin_id\", \"to\": \"nsadmin_id\"}],\n        \"source\": {\"fact\":\"nsadmin_messages\", \"rollup\":{\"needRollup\":\"false\"},\"lookUpKeys\":[\"nsadmin_id\"]},\n        \"target\": {\"fact\":\"contact_info\", \"rollup\":{\"needRollup\":\"false\"},\"lookUpKeys\":[\"nsadmin_id\"]},\n        \"rollup\":{\"needRollup\":\"true\", \"rollupOnKeys\": [\"nadmin_id\"]}\n}',1,'2018-10-02 06:04:07','column-contact_info-1'),
(2,'column','{\n        \"joinKeys\": [{\"from\": \"event_id\", \"to\": \"issual_coupon_id\"}],\n        \"source\": {\"fact\":\"coupons\", \"rollup\":{\"needRollup\":\"false\"},\"lookUpKeys\":[\"event_id\"]},\n        \"target\": {\"fact\":\"coupons\", \"rollup\":{\"needRollup\":\"false\"},\"lookUpKeys\":[\"issual_coupon_id\"]},\n        \"rollup\":{\"needRollup\":\"true\", \"rollupOnKeys\": [\"event_id\"]}\n}',1,'2018-10-07 03:28:35','column-coupons-1'),
(3,'column','{\n        \"joinKeys\": [{\"from\": \"dim_membership_id\", \"to\": \"dim_bill_type_id\"}, {\"from\": \"bill_id\", \"to\": \"bill_id\"}],\n        \"source\": {\"fact\":\"bill_lineitems\", \"rollup\":{\"needRollup\":\"false\"},\"lookUpKeys\":[\"dim_membership_id\",\"bill_id\"]},\n        \"target\": {\"fact\":\"payment_details_fact\", \"rollup\":{\"needRollup\":\"false\"},\"lookUpKeys\":[\"dim_bill_type_id\",\"bill_id\"]},\n        \"rollup\":{\"needRollup\":\"false\"}\n}',1,'2018-10-02 06:04:07','column-payment_details_fact-1'),
(4,'resultant','{\n	\"joinKeys\": [{\n		\"from\": \"dim_event_user_id\",\n		\"to\": \"dim_event_user_id\"\n	}],\n	\"source\": [{\n			\"fact\": \"bill_lineitems\",\n			\"factAlias\": \"B\",\n			\"rollup\": {\n				\"needRollup\": \"false\"\n			}\n		},\n		{\n			\"fact\": \"contact_info\",\n			\"factAlias\": \"C\",\n			\"dimensionsInvolved\": [{\n				\"name\": \"campaign_msg\",\n				\"alias\": \"CG\",\n				\"attributes\": [\"is_recurring\",\"campaign_end_date\"]\n			}],\n			\"rollup\": {\n				\"needRollup\": \"false\"\n			}\n		}\n	],\n	\"target\": {\n		\"fact\": \"response_info\",\n		\"rollup\": {\n			\"needRollup\": \"false\"\n		}\n	},\n	\"attributionKeys\": [],\n	\"whereClause\": [\"(B.dim_event_date_id > C.dim_event_date_id OR (B.dim_event_date_id = C.dim_event_date_id AND B.dim_event_time_id > C.dim_event_time_id))\", \"(to_date(concat(B.dim_event_date_id div 10000, \'-\', ( B.dim_event_date_id div 100 ) % 100, \'-\', B.dim_event_date_id % 100  ))) < if(C.is_recurring = \'TRUE\', date_add(to_date(concat(C.dim_event_date_id div 10000, \'-\', ( C.dim_event_date_id div 100 ) % 100, \'-\', C.dim_event_date_id % 100   )),16), date_add(C.campaign_end_date ,1))\"],\n	\"rollup\": {\n		\"needRollup\": \"false\"\n	},\n	\"udaf\":\"FIRST\",\n	\"overrideTargetExpression\":\"C.dim_event_date_id AS dim_campaign_schedule_date_id, C.dim_event_time_id AS dim_campaign_schedule_time_id\"\n}',1,'2018-10-09 03:48:49','resultant-response_info-no-lookup-11'),
(5,'conditional','{\n        \"joinKeys\": [{\n                \"from\": \"dim_event_user_id\",\n                \"to\": \"dim_event_user_id\"\n        },\n {\n                \"from\": \"dim_membership_id\",\n                \"to\": \"dim_membership_id\"\n        },{\n                \"from\": \"bill_id\",\n                \"to\": \"bill_id\"\n        },{\n                \"from\": \"line_item_id\",\n                \"to\": \"line_item_id\"\n        }],\n        \"source\": {\n                        \"fact\": \"points\",\n                        \"factAlias\": \"P\",\n                        \"dimensionsInvolved\": [{\n                                \"name\": \"zone_tills\",\n                                \"alias\": \"zt\"\n                        }],\n                        \"filters\":[\"P.deducted_points > 0 \"],\n                        \"computation\": \"sum(case when dim_deduction_type_id = 4 then deducted_points else 0 end) as redeemed_points, sum(case when dim_points_event_type_id = 1 then allocated_points else 0 end) as allocated_points_sum\",\n                        \"rollup\": {\n                                \"needRollup\": \"true\",\n                                \"rollupOnKeys\": [\"dim_event_user_id\", \"store\", \"dim_event_date_id\", \"dim_event_time_id\"]\n                        },\n                        \"lookUpKeys\":[\"dim_event_user_id\",\"dim_event_date_id\"]\n                },\n        \"target\": {\n                \"fact\": \"bill_lineitems\",\n                \"factAlias\": \"B\",\n                \"dimensionsInvolved\": [{\n                                \"name\": \"zone_tills\",\n                                \"alias\": \"bt\",\n                                \"attributes\": [\"store\"]\n                        }],\n                \"rollup\": {\n                        \"needRollup\": \"false\"\n                },\n                \"lookUpKeys\":[\"dim_event_user_id\",\"dim_event_date_id\"]\n        },\n        \"attributionKeys\": [{\n               \"from\": \"dim_event_user_id\",\n               \"to\": \"dim_event_user_id\"\n       }, {\n               \"from\": \"store\",\n               \"to\": \"store\"\n       }, {\n               \"from\": \"dim_event_date_id\",\n               \"to\": \"dim_event_date_id\"\n       }],\n        \"whereClause\": [\"B.dim_event_time_id BETWEEN P.dim_event_time_id - 15\", \"P.dim_event_time_id + 15\"],\n        \"rollup\": {\n                \"needRollup\": \"true\",\n                \"rollupOnKeys\": [ \"dim_membership_id\", \"bill_id\", \"line_item_id\", \"dim_event_user_id\" ],\n                \"computation\": \"SUM(redeemed_points_final) AS redeemed_points, SUM(allocated_points_final) AS allocated_points\"\n        },\n        \"udaf\":\"case when dense_rank() over (partition by B.dim_event_user_id, B.dim_event_zone_till_id, B.dim_event_date_id ORDER BY ABS(B.dim_event_time_id - P.dim_event_time_id)) = 1 then P.redeemed_points else 0 end as redeemed_points_final, case when dense_rank() over (partition by B.dim_event_user_id, B.dim_event_zone_till_id, B.dim_event_date_id ORDER BY ABS(B.dim_event_time_id - P.dim_event_time_id)) = 1 then P.allocated_points_sum else 0 end as allocated_points_final \"\n}',1,'2018-11-08 01:43:17','conditional-bill_lineitems-1'),
(6,'conditional','{\n        \"joinKeys\": [{\n                        \"from\": \"dim_coupon_event_type_id\",\n                        \"to\": \"dim_coupon_event_type_id\"\n                },\n                {\n                        \"from\": \"event_id\",\n                        \"to\": \"event_id\"\n                }\n        ],\n        \"source\": {\n                \"fact\": \"bill_lineitems\",\n                \"factAlias\": \"B\",\n                \"filters\": [\"B.dim_membership_id = 1\",\"B.dim_bill_outlier_status_id = 1\"],\n                \"dimensionsInvolved\": [{\n                        \"name\": \"zone_tills\",\n                        \"alias\": \"zt\",\n                        \"attributes\": [\"store\"]\n                }],\n                \"computation\": \"first(bill_amount) as redeemed_bill_amount\",\n                \"rollup\": {\n                        \"needRollup\": \"true\",\n                        \"rollupOnKeys\": [\"dim_membership_id\", \"bill_id\"]\n                },\n                \"lookUpKeys\":[\"dim_event_user_id\",\"dim_event_date_id\"]\n        },\n        \"target\": {\n                \"fact\": \"coupons\",\n                \"factAlias\": \"C\",\n                \"filters\": [\"C.dim_coupon_event_type_id = 2\"],\n                \"dimensionsInvolved\": [{\n                        \"name\": \"zone_tills\",\n                        \"alias\": \"ct\",\n                        \"attributes\": [\"store\"]\n                }],\n                \"rollup\": {\n                        \"needRollup\": \"false\"\n                },\n                \"lookUpKeys\":[\"dim_event_user_id\",\"dim_event_date_id\"]\n        },\n        \"attributionKeys\": [{\n                \"from\": \"dim_event_user_id\",\n                \"to\": \"dim_event_user_id\"\n        }, {\n                \"from\": \"store\",\n                \"to\": \"store\"\n        }, {\n                \"from\": \"dim_event_date_id\",\n                \"to\": \"dim_event_date_id\"\n        }],\n        \"rollup\": {\n                \"needRollup\": \"true\",\n                \"rollupOnKeys\": [\"dim_coupon_event_type_id\", \"event_id\"],\n                \"computation\": \"SUM(redeemed_bill_amount_final) AS redemption_bill_amount\"\n        },\n        \"udaf\": \"case when dense_rank() over (partition by C.issual_coupon_id, C.dim_coupon_event_type_id, C.dim_event_user_id, C.dim_event_zone_till_id, C.dim_event_date_id ORDER BY ABS(C.dim_event_time_id - B.dim_event_time_id)) = 1 then B.redeemed_bill_amount else 0 end as redeemed_bill_amount_final\"\n}',1,'2020-08-30 20:31:22','conditional-coupons-1'),
(7,'conditional','{\n   \"joinKeys\": [{\n       \"from\": \"dim_event_user_id\",\n       \"to\": \"dim_event_user_id\"\n   },\n{\n       \"from\": \"dim_membership_id\",\n       \"to\": \"dim_membership_id\"\n   },{\n       \"from\": \"bill_id\",\n       \"to\": \"bill_id\"\n   },{\n       \"from\": \"line_item_id\",\n       \"to\": \"line_item_id\"\n   }],\n   \"source\": {\n           \"fact\": \"points\",\n           \"factAlias\": \"P\",\n           \"dimensionsInvolved\": [{\n               \"name\": \"zone_tills\",\n               \"alias\": \"zt\"\n           }],\n           \"filters\":[\"P.deducted_points > 0 \"],\n           \"computation\": \"sum(case when dim_deduction_type_id = 4 then deducted_points else 0 end) as redeemed_points, sum(case when dim_points_event_type_id = 1 then allocated_points else 0 end) as allocated_points_sum\",\n           \"rollup\": {\n               \"needRollup\": \"true\",\n               \"rollupOnKeys\": [\"dim_event_user_id\", \"store\", \"dim_event_date_id\", \"dim_event_time_id\"]\n           }\n       },\n   \"target\": {\n       \"fact\": \"bill_lineitems\",\n       \"factAlias\": \"B\",\n       \"dimensionsInvolved\": [{\n               \"name\": \"zone_tills\",\n               \"alias\": \"bt\",\n               \"attributes\": [\"store\"]\n           }],\n       \"rollup\": {\n           \"needRollup\": \"false\"\n       }\n   },\n   \"attributionKeys\": [{\n               \"from\": \"dim_event_user_id\",\n               \"to\": \"dim_event_user_id\"\n       }, {\n               \"from\": \"store\",\n               \"to\": \"store\"\n       }, {\n               \"from\": \"dim_event_date_id\",\n               \"to\": \"dim_event_date_id\"\n       }],\n   \"whereClause\": [\" 1=1 \"],\n   \"rollup\": {\n       \"needRollup\": \"true\",\n       \"rollupOnKeys\": [ \"dim_membership_id\", \"bill_id\", \"line_item_id\", \"dim_event_user_id\" ],\n       \"computation\": \"SUM(redeemed_points_final) AS redeemed_points, SUM(allocated_points_final) AS allocated_points\"\n   },\n   \"udaf\":\"case when dense_rank() over (partition by B.dim_event_user_id, B.dim_event_zone_till_id, B.dim_event_date_id ORDER BY ABS(B.dim_event_time_id - P.dim_event_time_id)) = 1 then P.redeemed_points else 0 end as redeemed_points_final, case when dense_rank() over (partition by B.dim_event_user_id, B.dim_event_zone_till_id, B.dim_event_date_id ORDER BY ABS(B.dim_event_time_id - P.dim_event_time_id)) = 1 then P.allocated_points_sum else 0 end as allocated_points_final \"\n}',1,'2018-11-08 01:43:17','conditional-bill_lineitems-no-lookup-1'),
(8,'column','{\n    \"joinKeys\": [\n        {\n            \"from\": \"event_id\",\n            \"to\": \"deduction_summary_id\"\n        },\n        {\n            \"from\": \"dim_event_user_id\",\n            \"to\": \"dim_event_user_id\"\n        }\n    ],\n    \"source\": {\n        \"fact\": \"points_redemption_summary\",\n        \"factAlias\": \"PRS\",\n        \"dimensionsInvolved\": [],\n        \"filters\": [],\n        \"rollup\":{\n            \"needRollup\": \"false\"\n        }\n    },\n    \"target\":{\n        \"fact\": \"points\",\n        \"factAlias\": \"P\",\n        \"dimensionsInvolved\": [],\n        \"filters\": [\"P.deduction_summary_id > 0\", \"P.dim_deduction_type_id IN (4,7,9)\"],\n        \"rollup\":{\n            \"needRollup\": \"false\"\n        }\n    },\n    \"rollup\":{\n        \"needRollup\": \"false\"\n    }\n}',1,'2020-07-07 02:46:53','column-points-no-lookup-1'),
(9,'conditional','{\n        \"joinKeys\": [{\n                        \"from\": \"dim_coupon_event_type_id\",\n                        \"to\": \"dim_coupon_event_type_id\"\n                },\n                {\n                        \"from\": \"event_id\",\n                        \"to\": \"event_id\"\n                }\n        ],\n        \"source\": {\n                \"fact\": \"bill_lineitems\",\n                \"factAlias\": \"B\",\n                \"filters\": [\"B.dim_membership_id = 1\",\"B.dim_bill_outlier_status_id = 1\"],\n                \"dimensionsInvolved\": [{\n                        \"name\": \"zone_tills\",\n                        \"alias\": \"zt\",\n                        \"attributes\": [\"store\"]\n                }],\n                \"computation\": \"first(bill_amount) as redeemed_bill_amount\",\n                \"rollup\": {\n                        \"needRollup\": \"true\",\n                        \"rollupOnKeys\": [\"dim_membership_id\", \"bill_id\"]\n                },\n                \"lookUpKeys\":[\"dim_event_user_id\",\"dim_event_date_id\"]\n        },\n        \"target\": {\n                \"fact\": \"coupons\",\n                \"factAlias\": \"C\",\n                \"filters\": [\"C.dim_coupon_event_type_id = 2\"],\n                \"dimensionsInvolved\": [{\n                        \"name\": \"zone_tills\",\n                        \"alias\": \"ct\",\n                        \"attributes\": [\"store\"]\n                }],\n                \"rollup\": {\n                        \"needRollup\": \"false\"\n                },\n                \"lookUpKeys\":[\"dim_event_user_id\",\"dim_event_date_id\"]\n        },\n        \"attributionKeys\": [{\n                \"from\": \"dim_event_user_id\",\n                \"to\": \"dim_event_user_id\"\n        }, {\n                \"from\": \"store\",\n                \"to\": \"store\"\n        }, {\n                \"from\": \"dim_event_date_id\",\n                \"to\": \"dim_event_date_id\"\n        }],\n        \"rollup\": {\n                \"needRollup\": \"true\",\n                \"rollupOnKeys\": [\"dim_coupon_event_type_id\", \"event_id\"],\n                \"computation\": \"SUM(redeemed_bill_amount_final) AS redemption_bill_amount\"\n        },\n        \"udaf\": \"case when dense_rank() over (partition by C.issual_coupon_id, C.dim_coupon_event_type_id, C.dim_event_user_id, C.dim_event_zone_till_id, C.dim_event_date_id ORDER BY ABS(C.dim_event_time_id - B.dim_event_time_id)) = 1 then B.redeemed_bill_amount else 0 end as redeemed_bill_amount_final\"\n}',0,'2020-08-30 20:31:22','conditional-coupons-0'),
(10,'resultant','{\"joinKeys\": [{\"from\": \"dim_event_user_id\",\"to\": \"dim_event_user_id\"},{\"from\": \"ou_id\",\"to\": \"ou_id\"}],\"source\": [{\"fact\": \"bill_lineitems\",\"factAlias\": \"B\",\"dimensionsInvolved\": [{\"name\": \"org_unit_tills\",\"alias\": \"B_OU\",\"attributes\": [\"ou_id\"]}],\"rollup\": {\"needRollup\": \"false\"}},{\"fact\": \"contact_info\",\"factAlias\": \"C\",\"dimensionsInvolved\": [{\"name\": \"campaign_msg\",\"alias\": \"CG\",\"attributes\": [\"is_recurring\",\"campaign_end_date\"]},{\"name\": \"org_unit_tills\",\"alias\": \"C_OU\",\"attributes\": [\"ou_id\"]}],\"rollup\": {\"needRollup\": \"false\"}}],\"target\": {\"fact\": \"response_info\",\"rollup\": {\"needRollup\": \"false\"}},\"attributionKeys\": [],\"whereClause\": [\"(B.dim_event_date_id > C.dim_event_date_id OR (B.dim_event_date_id = C.dim_event_date_id AND B.dim_event_time_id > C.dim_event_time_id))\", \"(to_date(concat(B.dim_event_date_id div 10000, \'-\', ( B.dim_event_date_id div 100 ) % 100, \'-\', B.dim_event_date_id % 100  ))) < if(C.is_recurring = \'TRUE\', date_add(to_date(concat(C.dim_event_date_id div 10000, \'-\', ( C.dim_event_date_id div 100 ) % 100, \'-\', C.dim_event_date_id % 100   )),16), date_add(C.campaign_end_date ,1))\"],\"rollup\": {\"needRollup\": \"false\"},\"udaf\":\"FIRST\",\"overrideTargetExpression\":\"C.dim_event_date_id AS dim_campaign_schedule_date_id, C.dim_event_time_id AS dim_campaign_schedule_time_id\"}',1,'2021-08-16 05:08:09','resultant-response_info-no-lookup-12'),
(11,'fullouter','{\"joinKeys\":[{\"from\":\"dim_org_unit_id\",\"to\":\"dim_org_unit_id\"},{\"from\":\"dim_communication_channel_id\",\"to\":\"dim_communication_channel_id\"}],\"source\":[{\"fact\":\"subscription_status_change_log\",\"factAlias\":\"B\",\"filters\":[\"B.dim_org_unit_id not in (-10001, -10002, -10001)\",\"B.dim_communication_channel_id not in (-10001, -10002, -10001)\"],\"rollup\":{\"needRollup\":\"false\"}},{\"fact\":\"subscription_config\",\"factAlias\":\"C\",\"filters\":[\"C.dim_org_unit_id not in (-10001, -10002, -10001)\",\"C.dim_communication_channel_id not in (-10001, -10002, -10001)\"],\"rollup\":{\"needRollup\":\"false\"}}],\"target\":{\"fact\":\"subscription_status_change_fact\",\"rollup\":{\"needRollup\":\"false\"}},\"udaf\":\"CASE WHEN B.dim_optin_status_id IN (-10001, -10002, -10003) AND C.dim_optin_status_id != -10001 THEN C.dim_optin_status_id WHEN B.dim_optin_status_id IN (-10001, -10002, -10003) AND C.dim_optin_strategy_id = 2 THEN 4 WHEN B.dim_optin_status_id IN (-10001, -10002, -10003) AND C.dim_optin_strategy_id = 1 THEN 3 ELSE B.dim_optin_status_id END AS dim_optin_status_id\"}',1,'2020-12-21 02:21:14','fullouter-subscription_status_change_fact-1');


-- Dump completed on 2021-10-27 12:15:31
